CREATE USER TIKITAKA IDENTIFIED BY TIKITAKA;
GRANT RESOURCE, CONNECT, CREATE VIEW TO TIKITAKA;

=================

CREATE TABLE MEMBER(
EMAIL VARCHAR2(200) PRIMARY KEY,
NAME VARCHAR2(30) NOT NULL,
PASSWORD VARCHAR2(200) NOT NULL,
PROFILE_IMG VARCHAR2(200),
ENROLL_DATE DATE DEFAULT SYSDATE,
LOCATION VARCHAR2(200),
SHORTDESCRIPTION CLOB,
HOMEPAGE VARCHAR2(200),
PHONE1 VARCHAR2(100),
PHONE2 VARCHAR2(100),
PHONE3 VARCHAR2(100),
STOP_DATE DATE,
EXP_DATE DATE

);

COMMENT ON COLUMN MEMBER.EMAIL IS '이메일';
COMMENT ON COLUMN MEMBER.NAME IS '이름';
COMMENT ON COLUMN MEMBER.PASSWORD IS '비밀번호';
COMMENT ON COLUMN MEMBER.PROFILE_IMG IS '프로필이미지';
COMMENT ON COLUMN MEMBER.ENROLL_DATE IS '가입일';
COMMENT ON COLUMN MEMBER.LOCATION IS '지역';
COMMENT ON COLUMN MEMBER.SHORTDESCRIPTION IS '소개';
COMMENT ON COLUMN MEMBER.HOMEPAGE IS '홈페이지';
COMMENT ON COLUMN MEMBER.PHONE1 IS '번호1';
COMMENT ON COLUMN MEMBER.PHONE2 IS '번호2';
COMMENT ON COLUMN MEMBER.PHONE3 IS '번호3';
COMMENT ON COLUMN MEMBER.STOP_DATE IS '정지날짜';
COMMENT ON COLUMN MEMBER.EXP_DATE IS '??';

CREATE TABLE PAYMENT_INFO(
EMAIL VARCHAR2(200) NOT NULL,
P_METHOD VARCHAR2(30) NOT NULL,
CARDNUM NUMBER,
VALIDITY VARCHAR2(30),
BIRTHDAY NUMBER(6) ,
CARDPWD NUMBER(2) ,
BANK VARCHAR2(30),
ACNAME VARCHAR2(30) ,
ACINFO VARCHAR2(30),
ACNUM NUMBER,

FOREIGN KEY (EMAIL) REFERENCES MEMBER (EMAIL)
 );

COMMENT ON COLUMN PAYMENT_INFO.EMAIL IS '유저아이디';
COMMENT ON COLUMN PAYMENT_INFO.P_METHOD IS '결제수단';
COMMENT ON COLUMN PAYMENT_INFO.CARDNUM IS '카드번호';
COMMENT ON COLUMN PAYMENT_INFO.VALIDITY IS '유효기간';
COMMENT ON COLUMN PAYMENT_INFO.BIRTHDAY IS '생년월일';
COMMENT ON COLUMN PAYMENT_INFO.CARDPWD IS '카드 비밀번호';
COMMENT ON COLUMN PAYMENT_INFO.BANK IS '결제은행';
COMMENT ON COLUMN PAYMENT_INFO.ACNAME IS '예금주명';
COMMENT ON COLUMN PAYMENT_INFO.ACINFO IS '계좌명의';
COMMENT ON COLUMN PAYMENT_INFO.ACNUM IS '계좌번호';

CREATE TABLE PROJECT(
EMAIL VARCHAR2(200),
P_PROJECT_CODE  NUMBER,
P_PROJECT_NUMBER NUMBER,
P_TITLE VARCHAR2(150),
P_REP_IMG VARCHAR2(300),
P_SUMMARY VARCHAR2(200),
P_CATEGORY VARCHAR2(50),
P_PROFILE_IMG VARCHAR2(200),
P_NAME VARCHAR2(60),
P_INTRODUCE VARCHAR2(900),
P_PRICE NUMBER,
P_END_DATE DATE,
P_GIFT_ITEM VARCHAR2(300),
P_REFUND VARCHAR2(3000),
P_DESCRIPTION_VIDEO VARCHAR2(300),
P_STORY CLOB,
P_EMAIL VARCHAR2(200),
P_PHONE VARCHAR2(100),
P_BANK_TRADING VARCHAR2(100),
P_BANK_NAME VARCHAR2(100),
P_BANK_NUMBER VARCHAR2(100),
P_BANK_KINDS CHAR(1),
P_OK CHAR(1),
P_SEND_CONFIRM CHAR(1),
P_CURRENTAMOUNT NUMBER,
P_SPONSOR_COUNT NUMBER,
P_ENROLL_DATE DATE,

FOREIGN KEY (EMAIL) REFERENCES MEMBER (EMAIL),
PRIMARY KEY(P_PROJECT_CODE)

);

CREATE SEQUENCE SEQ_P_NUM START WITH 1 INCREMENT BY 1 NOCYCLE;

COMMENT ON COLUMN PROJECT.EMAIL IS '프로젝트_멤버이메일(아이디)';
COMMENT ON COLUMN PROJECT.P_PROJECT_CODE IS '프로젝트 코드';
COMMENT ON COLUMN PROJECT.P_PROJECT_NUMBER IS '프로젝트 번호';
COMMENT ON COLUMN PROJECT.P_TITLE IS '프로젝트 제목';
COMMENT ON COLUMN PROJECT.P_REP_IMG IS '프로젝트 대표이미지';
COMMENT ON COLUMN PROJECT.P_SUMMARY IS '프로젝트 요약';
COMMENT ON COLUMN PROJECT.P_CATEGORY IS '프로젝트 카테고리';
COMMENT ON COLUMN PROJECT.P_PROFILE_IMG IS '프로필 이미지';
COMMENT ON COLUMN PROJECT.P_NAME IS '진행자이름';
COMMENT ON COLUMN PROJECT.P_INTRODUCE IS '진행자소개';
COMMENT ON COLUMN PROJECT.P_PRICE IS '목표금액';
COMMENT ON COLUMN PROJECT.P_END_DATE IS '프로젝트 마감일';
COMMENT ON COLUMN PROJECT.P_GIFT_ITEM IS '아이템 이름';
COMMENT ON COLUMN PROJECT.P_REFUND IS '환불 및 교환 정책';
COMMENT ON COLUMN PROJECT.P_DESCRIPTION_VIDEO IS '프로젝트 소개영상(선택항목)';
COMMENT ON COLUMN PROJECT.P_STORY IS '프로젝트 스토리';
COMMENT ON COLUMN PROJECT.P_EMAIL IS '이메일주소';
COMMENT ON COLUMN PROJECT.P_PHONE IS '휴대폰번호';
COMMENT ON COLUMN PROJECT.P_BANK_TRADING IS '입금은행';
COMMENT ON COLUMN PROJECT.P_BANK_NAME IS '예금주명';
COMMENT ON COLUMN PROJECT.P_BANK_NUMBER IS '계좌번호';
COMMENT ON COLUMN PROJECT.P_BANK_KINDS IS '계좌종류';
COMMENT ON COLUMN PROJECT.P_OK IS '프로젝트 승인여부';
COMMENT ON COLUMN PROJECT.P_SEND_CONFIRM IS '프로젝트 송금여부';
COMMENT ON COLUMN PROJECT.P_CURRENTAMOUNT IS '현재금액';
COMMENT ON COLUMN PROJECT.P_SPONSOR_COUNT IS '후원자수';
COMMENT ON COLUMN PROJECT.P_ENROLL_DATE IS '등록일';

CREATE TABLE BANNER(
BANNER_CODE NUMBER,
BANNER_IMAGE VARCHAR2(200),
BANNER_LEVEL NUMBER DEFAULT 0,

FOREIGN KEY (BANNER_CODE) REFERENCES PROJECT (P_PROJECT_CODE)
);



COMMENT ON COLUMN BANNER.BANNER_CODE IS '배너코드';
COMMENT ON COLUMN BANNER.BANNER_IMAGE IS '배너이미지';
COMMENT ON COLUMN BANNER.BANNER_LEVEL IS '배너레벨 (div위치)';

CREATE TABLE GIFT(
P_PROJECT_CODE NUMBER,
EMAIL VARCHAR2(200),
G_CODE NUMBER PRIMARY KEY,
G_PRICE NUMBER,
G_DESCRIPTION VARCHAR2(150),
G_ITEM  VARCHAR2(300),
G_SEND_DATE DATE,
G_REMITED NUMBER,
G_TRANSFER_CHECK VARCHAR2(50),


FOREIGN KEY (P_PROJECT_CODE) REFERENCES PROJECT (P_PROJECT_CODE),
FOREIGN KEY (EMAIL) REFERENCES MEMBER (EMAIL)
);

CREATE SEQUENCE SEQ_G_NUM START WITH 1 INCREMENT BY 1 NOCYCLE;

COMMENT ON COLUMN GIFT.P_PROJECT_CODE IS '선물_프로젝트코드';
COMMENT ON COLUMN GIFT.EMAIL IS '선물_멤버이메일(아이디)';
COMMENT ON COLUMN GIFT.G_PRICE IS '최소 후원금액';
COMMENT ON COLUMN GIFT.G_DESCRIPTION IS '선물 설명';
COMMENT ON COLUMN GIFT.G_ITEM IS '선물에 포함된 아이템';
COMMENT ON COLUMN GIFT.G_SEND_DATE IS '예상 전달일';
COMMENT ON COLUMN GIFT.G_REMITED IS '한정품 숫자';
COMMENT ON COLUMN GIFT.G_TRANSFER_CHECK IS '선물 배달 여부';
COMMENT ON COLUMN GIFT.G_CODE IS '선물 기본키';

CREATE TABLE MESSAGE(
P_PROJECT_CODE NUMBER,
M_CODE NUMBER PRIMARY KEY,
M_WRITER VARCHAR2(200),
M_RECEIVER VARCHAR2(200),
M_KINDS VARCHAR2(30),
M_CONTENT VARCHAR2(150),
M_SEND_DATE DATE DEFAULT SYSDATE,
M_READ_FLAG CHAR(1) DEFAULT 'F',

FOREIGN KEY (P_PROJECT_CODE) REFERENCES PROJECT (P_PROJECT_CODE),
FOREIGN KEY (M_WRITER) REFERENCES MEMBER (EMAIL),
FOREIGN KEY (M_RECEIVER) REFERENCES MEMBER (EMAIL)
);

CREATE SEQUENCE SEQ_MSG START WITH 1 INCREMENT BY 1;

COMMENT ON COLUMN MESSAGE.P_PROJECT_CODE IS '메세지_프로젝트코드';
COMMENT ON COLUMN MESSAGE.M_CODE IS '메시지 코드';
COMMENT ON COLUMN MESSAGE.M_WRITER IS '보낸사람 이메일';
COMMENT ON COLUMN MESSAGE.M_RECEIVER IS '받는사람 이메일';
COMMENT ON COLUMN MESSAGE.M_KINDS  IS '메세지 종류';
COMMENT ON COLUMN MESSAGE.M_CONTENT IS '메세지 내용';
COMMENT ON COLUMN MESSAGE.M_SEND_DATE IS '메세지 송신일';
COMMENT ON COLUMN MESSAGE.M_READ_FLAG IS '확인 여부';

CREATE TABLE POST(
  POST_CODE NUMBER PRIMARY KEY,
  P_PROJECT_CODE NUMBER,
  EMAIL VARCHAR2(500),
  CONTENT CLOB,
  WRITTEN_DATE DATE DEFAULT SYSDATE,
  DELFLAG CHAR(1) DEFAULT 'F',
  
  FOREIGN KEY(EMAIL) REFERENCES MEMBER(EMAIL),
  FOREIGN KEY(P_PROJECT_CODE) REFERENCES PROJECT(P_PROJECT_CODE)
);

CREATE SEQUENCE SEQ_POST START WITH 1 INCREMENT BY 1;

COMMENT ON COLUMN POST.POST_CODE IS '게시글코드';
COMMENT ON COLUMN POST.P_PROJECT_CODE IS '프로젝트코드';
COMMENT ON COLUMN POST.EMAIL IS '게시글_멤버이메일(아이디)';
COMMENT ON COLUMN POST.CONTENT IS '내용';
COMMENT ON COLUMN POST.WRITTEN_DATE IS '작성일';
COMMENT ON COLUMN POST.DELFLAG IS '삭제유무';

CREATE TABLE REPLY(
  REPLY_CODE NUMBER PRIMARY KEY,
  POST_CODE NUMBER,
  CONTENT VARCHAR2(3000),
  EMAIL VARCHAR2(500),
  WRITTEN_DATE DATE DEFAULT SYSDATE,
  DELFLAG CHAR(1) DEFAULT 'F',
  
  FOREIGN KEY(EMAIL) REFERENCES MEMBER(EMAIL),
  FOREIGN KEY(POST_CODE) REFERENCES POST(POST_CODE)
);

CREATE SEQUENCE SEQ_REPLY START WITH 1 INCREMENT BY 1;

COMMENT ON COLUMN REPLY.REPLY_CODE IS '댓글코드';
COMMENT ON COLUMN REPLY.POST_CODE IS '게시글코드';
COMMENT ON COLUMN REPLY.CONTENT IS '내용';
COMMENT ON COLUMN REPLY.EMAIL IS '댓글_멤버이메일(아이디)';
COMMENT ON COLUMN REPLY.WRITTEN_DATE IS '작성일';
COMMENT ON COLUMN REPLY.DELFLAG IS '삭제유무';

CREATE TABLE SUPPORT(
  EMAIL VARCHAR2(500),
  P_PROJECT_CODE NUMBER,
  SUPPORTING_AMOUNT NUMBER,
  P_GIFT_ITEM VARCHAR2(300),
  SUPPORTED_DATE DATE DEFAULT SYSDATE,
  ADDRESS VARCHAR2(200),
  
  FOREIGN KEY(EMAIL) REFERENCES MEMBER(EMAIL),
  FOREIGN KEY(P_PROJECT_CODE) REFERENCES PROJECT(P_PROJECT_CODE),
  PRIMARY KEY(EMAIL, P_PROJECT_CODE)
);


COMMENT ON COLUMN SUPPORT.EMAIL IS '후원하기_멤버이메일(아이디)';
COMMENT ON COLUMN SUPPORT.P_PROJECT_CODE IS '프로젝트코드';
COMMENT ON COLUMN SUPPORT.SUPPORTING_AMOUNT IS '후원금액';
COMMENT ON COLUMN SUPPORT.P_GIFT_ITEM IS '받고싶은아이템';
COMMENT ON COLUMN SUPPORT.SUPPORTED_DATE IS '후원날짜';

ALTER TABLE SUPPORT RENAME COLUMN P_GIFT_ITEM TO G_CODE;
ALTER TABLE SUPPORT MODIFY G_CODE NUMBER;
ALTER TABLE SUPPORT ADD FOREIGN KEY(G_CODE) REFERENCES GIFT(G_CODE);
ALTER TABLE GIFT ADD G_SELECTED_COUNT NUMBER DEFAULT 0;
alter table support drop constraint SYS_C008445;
